# Web UI テスト (Testing)

このドキュメントでは、この人事管理システムの **Web UI（画面）** に関するテストの情報を提供します。

> **RESTful APIのテストについては、[APITESTING.md](APITESTING.md) を参照してください。**

## 概要

このプロジェクトでは、アプリケーションの品質と安定性を確保するために、単体テストと結合テストを導入しています。テストは主に、Webリクエストを処理するコントローラー層に焦点を当てています。

## 技術スタック

テストには以下のフレームワークとライブラリを使用しています。

-   **Spring Boot Test:** Spring Bootアプリケーションのテストを容易にするための包括的なサポートを提供します。
-   **JUnit 5:** Javaアプリケーションの標準的なテストフレームワークです。
-   **Mockito:** Service層などの依存関係をモック化（偽のオブジェクトに置き換え）するために使用します。これにより、テスト対象のコンポーネントを分離してテストできます。
-   **MockMvc:** Spring MVCコントローラーのテストを、実際にサーバーを起動することなく実行するためのフレームワークです。

これらの依存関係は `pom.xml` ファイルで管理されています。

## テストの実行方法

プロジェクトのルートディレクトリで以下のコマンドを実行することで、全てのテストを実行できます。

```bash
./mvnw test
```

このコマンドは、Mavenを使って `src/test/java` ディレクトリ配下にある全てのテストクラスを検出し、実行します。

## テストの種類

### 1. 結合テスト (`HrSystemApplicationTests.java`)

-   **目的:** Spring Bootアプリケーションのコンテキストが正常に読み込まれ、アプリケーション全体が問題なく起動できることを確認します。
-   **実装:** `@SpringBootTest` アノテーションをクラスに付与することで、テスト実行時に完全なアプリケーションコンテキストを読み込みます。

### 2. コントローラー単体テスト (`WebControllerTest.java`)

-   **目的:** `WebController` の各メソッドが、期待通りに動作することを確認します。HTTPリクエストの受信、適切なServiceメソッドの呼び出し、正しいビューへの遷移、Modelへのデータ設定などを検証します。
-   **実装:**
    -   `@WebMvcTest(WebController.class)` アノテーションを使い、`WebController` のみに対象を絞ったテストコンテキストを構築します。
    -   `@MockBean` を使って `DepartmentService` や `EmployeesService` のような外部依存をモック化し、データベースにアクセスすることなくコントローラーのロジックのみをテストします。
    -   `MockMvc` を使って、`GET` や `POST` といったHTTPリクエストをシミュレートし、レスポンスのステータスコード、リダイレクト先、ビュー名、Modelの属性などを検証します。

#### 主なテストケース

`WebControllerTest.java` では、部署管理と従業員管理の画面に関する以下のテストが実装されています。

##### 部署管理 (`/web/departments`)

-   **一覧画面:**
    -   `GET /web/departments`: 部署一覧画面が正常に表示されること。
-   **登録機能:**
    -   `GET /web/departments/new`: 新規登録フォームが正常に表示されること。
    -   `POST /web/departments` (成功): 有効なデータをPOSTすると、登録処理が実行され、一覧画面にリダイレクトされること。
    -   `POST /web/departments` (失敗): 無効なデータ（例: `location`が空）をPOSTすると、バリデーションエラーとなり、フォーム画面が再表示されること。
-   **更新機能:**
    -   `GET /web/departments/edit/{id}`: 既存のIDを指定すると、更新フォームが正常に表示されること。
    -   `POST /web/departments/update/{id}` (成功): 有効なデータをPOSTすると、更新処理が実行され、一覧画面にリダイレクトされること。
    -   `POST /web/departments/update/{id}` (失敗): 無効なデータ（例: `name`が空）をPOSTすると、バリデーションエラーとなり、フォーム画面が再表示されること。
-   **削除機能:**
    -   `POST /web/departments/delete/{id}`: 既存のIDを指定してPOSTすると、削除処理が実行され、一覧画面にリダイレクトされること。

##### 従業員管理 (`/web/employees`)

-   **一覧画面:**
    -   `GET /web/employees`: 従業員一覧画面が正常に表示されること。
-   **登録機能:**
    -   `GET /web/employees/new`: 新規登録フォームが正常に表示されること（部署の選択肢データも含まれる）。
    -   `POST /web/employees` (成功): 有効なデータをPOSTすると、登録処理が実行され、一覧画面にリダイレクトされること。
    -   `POST /web/employees` (失敗): 無効なデータ（例: `lastName`が空）をPOSTすると、バリデーションエラーとなり、フォーム画面が再表示されること。
-   **更新機能:**
    -   `GET /web/employees/edit/{id}`: 既存のIDを指定すると、更新フォームが正常に表示されること。
    -   `POST /web/employees/update/{id}` (成功): 有効なデータをPOSTすると、更新処理が実行され、一覧画面にリダイレクトされること。
    -   `POST /web/employees/update/{id}` (失敗): 無効なデータ（例: `email`の形式が不正）をPOSTすると、バリデーションエラーとなり、フォーム画面が再表示されること。
-   **削除機能:**
    -   `POST /web/employees/delete/{id}`: 既存のIDを指定してPOSTすると、削除処理が実行され、一覧画面にリダイレクトされること。

##### 例外処理・エッジケース

-   **存在しないリソースへのアクセス:**
    -   存在しないID (`999`など) を使って編集画面 (`GET`)、更新処理 (`POST`)、削除処理 (`POST`) を実行した場合をテストします。
    -   `ResourceNotFoundException` がスローされた際に、システムがクラッシュするのではなく、適切にエラーハンドリングされ、ユーザーにエラーが通知される（または一覧画面にリダイレクトされる）ことを検証します。
